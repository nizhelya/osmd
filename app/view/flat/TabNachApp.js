/*
 * File: app/view/flat/TabNachApp.js
 * Date: Fri Sep 18 2020 11:43:03 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Osmd.view.flat.TabNachApp', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.tabnachapp',

    requires: [
        'Osmd.view.flat.TabNachAppViewModel',
        'Ext.form.Panel',
        'Ext.form.FieldSet',
        'Ext.form.field.Number',
        'Ext.button.Button',
        'Ext.form.field.Checkbox',
        'Ext.form.field.Hidden',
        'Ext.grid.Panel',
        'Ext.view.Table',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.panel.Tool',
        'Ext.form.FieldContainer',
        'Ext.form.field.Date',
        'Ext.grid.column.Action',
        'Ext.grid.feature.Summary'
    ],

    viewModel: {
        type: 'tabnachapp'
    },
    id: 'tabNachApp',
    maxWidth: 925,
    scrollable: true,
    width: 925,
    layout: 'anchor',
    title: 'Нарахування',
    defaultListenerScope: true,

    items: [
        {
            xtype: 'form',
            anchor: '100%',
            height: 150,
            id: 'fmBti',
            width: 900,
            layout: 'absolute',
            title: '',
            items: [
                {
                    xtype: 'fieldset',
                    x: 5,
                    y: 5,
                    height: 61,
                    style: 'background-color: #DCDCDC;',
                    width: 900,
                    layout: 'absolute',
                    title: 'Площа квартири (м2)',
                    items: [
                        {
                            xtype: 'numberfield',
                            x: 5,
                            y: 5,
                            width: 130,
                            fieldLabel: 'Корисна',
                            labelSeparator: ' ',
                            labelWidth: 65,
                            name: 'area_full',
                            hideTrigger: true,
                            autoStripChars: true
                        },
                        {
                            xtype: 'numberfield',
                            x: 140,
                            y: 5,
                            width: 125,
                            fieldLabel: 'Житлова',
                            labelSeparator: ' ',
                            labelWidth: 60,
                            name: 'area_life',
                            hideTrigger: true,
                            autoStripChars: true
                        },
                        {
                            xtype: 'numberfield',
                            x: 275,
                            y: 5,
                            width: 130,
                            fieldLabel: 'Додаткова',
                            labelSeparator: ' ',
                            labelWidth: 70,
                            name: 'area_dop',
                            hideTrigger: true,
                            autoStripChars: true
                        },
                        {
                            xtype: 'numberfield',
                            x: 410,
                            y: 5,
                            width: 125,
                            fieldLabel: 'Балкон',
                            labelSeparator: ' ',
                            labelWidth: 50,
                            name: 'area_balk',
                            hideTrigger: true,
                            autoStripChars: true
                        },
                        {
                            xtype: 'numberfield',
                            x: 555,
                            y: 5,
                            width: 120,
                            fieldLabel: 'Кімнат',
                            labelSeparator: ' ',
                            labelWidth: 55,
                            name: 'room',
                            allowDecimals: false,
                            autoStripChars: true,
                            decimalPrecision: 0
                        },
                        {
                            xtype: 'button',
                            handler: function(button, event) {
                                //LOGIN & PASSWORD
                                var stUser = Ext.data.StoreManager.get("StUser");
                                var pvalues =stUser.getAt(0);
                                var login = pvalues.get('login');
                                var password = pvalues.get('password');

                                var form = Ext.getCmp('fmBti');//Форма
                                var stAppartment = Ext.data.StoreManager.get("StAppartment");//QueryAddress.getResults <Appartment>


                                var values=form.getValues();

                                var address_id = values.address_id;
                                var params = {
                                    login:login,
                                    password:password,
                                    what:'AppartmentUpdate',
                                    what_id:address_id
                                };
                                // console.log(values.address_id);
                                Ext.Object.merge(values, params);

                                // СОХРАНИТЬ ИЗМЕНЕНИЯ

                                QueryAddress.updateRecords(values,function(result){

                                    if (result.success){

                                        Ext.MessageBox.show({
                                            title: 'Обновление данных по квартире!',
                                            msg: result.msg,
                                            buttons: Ext.MessageBox.OK,
                                            icon: Ext.MessageBox.INFO,
                                            buttonText:{
                                                ok: "Закрыть!"
                                            }
                                        });

                                        stAppartment.load({
                                            params: {
                                                what_id:address_id,
                                                address_id: address_id,
                                                what:'Appartment',
                                                login:login,
                                                password:password
                                            },
                                            callback: function(records,operation,success){
                                                var rec = records[0];

                                                if(success){

                                                    form.getForm().loadRecord(rec);
                                                }
                                            },
                                            scope:this
                                        });



                                    }else{
                                        Ext.MessageBox.show({
                                            title: 'Внесение изменений',
                                            msg: 'Произошла ошибка',
                                            buttons: Ext.MessageBox.OK,
                                            buttonText:{
                                                ok: "Закрыть!"
                                            },
                                            icon: Ext.MessageBox.WARNING
                                        });
                                    }
                                });

                            },
                            x: 770,
                            y: 5,
                            formBind: true,
                            height: 25,
                            width: 105,
                            icon: 'resources/css/images/ico/xsldbg_refresh.png',
                            text: 'Оновить '
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 685,
                            y: 5,
                            fieldLabel: 'Ліфт',
                            labelWidth: 40,
                            name: 'lift',
                            boxLabel: 'Ні',
                            inputValue: 'да',
                            uncheckedValue: 'нет',
                            listeners: {
                                change: 'onCheckboxfieldChange31'
                            }
                        }
                    ]
                },
                {
                    xtype: 'fieldset',
                    x: 5,
                    y: 70,
                    height: 65,
                    style: 'background-color: #DCDCDC;',
                    width: 900,
                    layout: 'absolute',
                    title: 'Склад (людина)',
                    items: [
                        {
                            xtype: 'numberfield',
                            x: 5,
                            y: 5,
                            width: 135,
                            fieldLabel: 'Прописано',
                            labelSeparator: ' ',
                            labelWidth: 70,
                            name: 'tenant',
                            allowDecimals: false,
                            decimalPrecision: 0
                        },
                        {
                            xtype: 'numberfield',
                            x: 290,
                            y: 5,
                            width: 135,
                            fieldLabel: 'Відсутні',
                            labelSeparator: ' ',
                            labelWidth: 70,
                            name: 'absent',
                            allowDecimals: false,
                            decimalPrecision: 0,
                            minValue: 0
                        },
                        {
                            xtype: 'numberfield',
                            x: 155,
                            y: 5,
                            width: 120,
                            fieldLabel: 'Піднаймач',
                            labelSeparator: ' ',
                            labelWidth: 70,
                            name: 'podnan',
                            allowDecimals: false,
                            decimalPrecision: 0,
                            minValue: 0
                        },
                        {
                            xtype: 'numberfield',
                            anchor: '100%',
                            x: 515,
                            y: 315,
                            fieldLabel: 'Льготник',
                            labelSeparator: ' ',
                            labelWidth: 70,
                            name: 'lgotchik',
                            allowDecimals: false,
                            decimalPrecision: 0,
                            minValue: 0
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 435,
                            y: 5,
                            fieldLabel: 'Субсидія',
                            labelAlign: 'right',
                            labelWidth: 70,
                            name: 'subsidia',
                            boxLabel: 'Ні',
                            inputValue: 'да',
                            uncheckedValue: 'нет'
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 550,
                            y: 5,
                            fieldLabel: 'Пильга',
                            labelAlign: 'right',
                            labelWidth: 70,
                            name: 'lgota',
                            boxLabel: 'Ні',
                            inputValue: '1',
                            uncheckedValue: '0'
                        },
                        {
                            xtype: 'checkboxfield',
                            x: 675,
                            y: 5,
                            width: 200,
                            fieldLabel: 'Послуга квартплата',
                            labelAlign: 'right',
                            labelWidth: 130,
                            name: 'kvartplata',
                            boxLabel: 'Ні',
                            inputValue: 'да',
                            uncheckedValue: 'нет',
                            listeners: {
                                change: 'onCheckboxfieldChange21'
                            }
                        }
                    ]
                },
                {
                    xtype: 'hiddenfield',
                    fieldLabel: '',
                    labelSeparator: ' ',
                    name: 'address_id'
                }
            ]
        },
        {
            xtype: 'form',
            anchor: '100%',
            height: 700,
            id: 'fmInfoNachApp',
            scrollable: true,
            width: 1092,
            layout: 'absolute',
            title: '',
            items: [
                {
                    xtype: 'hiddenfield',
                    fieldLabel: '',
                    labelSeparator: ' ',
                    name: 'address_id'
                },
                {
                    xtype: 'hiddenfield',
                    labelSeparator: ' ',
                    labelStyle: '',
                    name: 'address'
                },
                {
                    xtype: 'hiddenfield',
                    fieldLabel: '',
                    labelSeparator: ' ',
                    labelStyle: '',
                    name: 'nanim'
                },
                {
                    xtype: 'gridpanel',
                    x: 5,
                    y: 5,
                    height: 545,
                    id: 'grNachKvartplata',
                    scrollable: true,
                    width: 230,
                    title: 'Період нарахування',
                    store: 'StTekNachApp',
                    viewConfig: {
                        height: 488,
                        emptyText: 'нет начислений'
                    },
                    columns: [
                        {
                            xtype: 'numbercolumn',
                            hidden: true,
                            dataIndex: 'address_id',
                            text: 'Address_id'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 50,
                            dataIndex: 'god',
                            menuDisabled: true,
                            text: 'рік',
                            format: '0'
                        },
                        {
                            xtype: 'datecolumn',
                            width: 75,
                            dataIndex: 'data',
                            menuDisabled: true,
                            text: 'місяць',
                            format: 'F'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if (value < 0) {
                                    metaData.style = 'color:red';
                                }
                                return value;

                            },
                            hidden: true,
                            width: 70,
                            align: 'right',
                            dataIndex: 'zadol',
                            menuDisabled: true,
                            text: 'задол'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            width: 49,
                            dataIndex: 'mec',
                            menuDisabled: true,
                            text: 'мес'
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            width: 62,
                            dataIndex: 'period',
                            menuDisabled: true,
                            text: 'Период'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if (value < 0) {
                                    metaData.style = 'color:red';
                                }
                                return value;

                            },
                            hidden: true,
                            width: 70,
                            align: 'right',
                            dataIndex: 'nachisleno',
                            menuDisabled: true,
                            text: 'начисл'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if (value < 0) {
                                    metaData.style = 'color:red';
                                }
                                return value;

                            },
                            hidden: true,
                            width: 70,
                            align: 'right',
                            dataIndex: 'oplacheno',
                            menuDisabled: true,
                            text: 'оплач'
                        },
                        {
                            xtype: 'gridcolumn',
                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                if (value < 0) {
                                    metaData.style = 'color:red';
                                }
                                return value;

                            },
                            width: 80,
                            align: 'right',
                            dataIndex: 'dolg',
                            menuDisabled: true,
                            text: 'борг'
                        }
                    ],
                    tools: [
                        {
                            xtype: 'tool',
                            callback: function(owner, tool, event) {
                                //STORE
                                var stUser = Ext.data.StoreManager.get("StUser");
                                var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
                                //LOGIN & PASSWORD
                                var values =stUser.getAt(0);
                                // FORM
                                var form = tool.findParentByType('form');
                                // DATA

                                //LOGIKA
                                StTekNachApp.load({
                                    params: {
                                        what:'KvartplataAppAll',
                                        address_id: values.get('address_id'),
                                        login:values.get('login'),
                                        password:values.get('password')
                                    },
                                    callback: function(records,operation,success){
                                        if(success){
                                            form.getForm().reset();
                                            form.getForm().loadRecord(records[0]);
                                        }else{
                                            form.getForm().reset();
                                        }
                                    },
                                    scope:this
                                });
                            },
                            tooltip: 'выбрать все записи',
                            type: 'plus'
                        }
                    ]
                },
                {
                    xtype: 'fieldcontainer',
                    x: 240,
                    y: 5,
                    height: 545,
                    style: 'background-color: #DCDCDC;',
                    width: 660,
                    layout: 'absolute',
                    fieldLabel: '',
                    labelAlign: 'top',
                    items: [
                        {
                            xtype: 'fieldset',
                            x: 255,
                            y: 0,
                            height: 135,
                            style: 'background-color: #F1EEEE;',
                            width: 200,
                            title: 'Р.фонд',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Заборгованість',
                                    name: 'rzadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Нараховано',
                                    name: 'remont',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Оплачено',
                                    name: 'roplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Борг',
                                    name: 'rdolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 260,
                            y: 215,
                            height: 110,
                            style: 'background-color: #F1EEEE;',
                            width: 195,
                            title: 'Борг МЖКЦ',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Заборгованість',
                                    name: 'fzadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Оплачено',
                                    name: 'foplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Борг',
                                    name: 'fdolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 455,
                            y: 215,
                            height: 110,
                            style: 'background-color: #F1EEEE;',
                            width: 190,
                            title: 'Борг Добробут',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Заборгованість',
                                    name: 'dzadol',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Оплачено',
                                    name: 'doplacheno',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Борг',
                                    name: 'ddolg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        },
                        {
                            xtype: 'fieldset',
                            x: 475,
                            y: 5,
                            height: 130,
                            style: 'background-color: #F1EEEE;',
                            width: 170,
                            title: 'Льгота',
                            items: [
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Sльг (м&sup2;)',
                                    labelWidth: 60,
                                    name: 'square_lg',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Льгота',
                                    labelWidth: 60,
                                    name: 'budjet',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    fieldLabel: 'Перер',
                                    labelWidth: 60,
                                    name: 'pbudjet',
                                    value: 0,
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true
                                }
                            ]
                        },
                        {
                            xtype: 'textfield',
                            x: 260,
                            y: 145,
                            style: 'background-color:#F0F8FF;font-size:10pt;;',
                            width: 385,
                            fieldLabel: 'инфо',
                            labelWidth: 40,
                            name: 'info',
                            fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;'
                        },
                        {
                            xtype: 'fieldset',
                            x: 15,
                            y: 5,
                            height: 525,
                            style: 'background-color: #F1EEEE;',
                            width: 235,
                            title: '',
                            items: [
                                {
                                    xtype: 'datefield',
                                    anchor: '100%',
                                    margin: '5 0 5 0',
                                    fieldLabel: 'Период нарах',
                                    labelWidth: 110,
                                    name: 'data',
                                    fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                    hideTrigger: true,
                                    format: 'F,Y',
                                    startDay: 1,
                                    submitFormat: 'Ymd'
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    style: 'background-color: #DCDCDC;',
                                    fieldLabel: 'Заборгованість',
                                    labelWidth: 110,
                                    name: 'zadol',
                                    value: 0,
                                    fieldStyle: 'font-size:12pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'fieldset',
                                    height: 134,
                                    style: 'background-color: #F1EEEE;',
                                    width: 211,
                                    title: 'Нараховано',
                                    items: [
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            width: 183,
                                            fieldLabel: 'S  (м&sup2;)',
                                            name: 'square',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'тариф',
                                            name: 'tarif',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true,
                                            decimalPrecision: 3,
                                            step: 0.001
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Квартплата',
                                            name: 'kvartplata',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Доп',
                                            name: 'dop',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'fieldset',
                                    height: 85,
                                    style: 'background-color: #F1EEEE;',
                                    width: 211,
                                    title: 'Перерераховано',
                                    items: [
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Тариф',
                                            name: 'ptarif',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true,
                                            decimalPrecision: 3
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'Сума',
                                            name: 'perer',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    style: 'background-color: #DCDCDC;',
                                    fieldLabel: 'Нараховано',
                                    labelWidth: 110,
                                    name: 'nachisleno',
                                    value: 0,
                                    fieldStyle: 'font-size:12pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    style: 'background-color: #DCDCDC;',
                                    fieldLabel: 'Оплачено',
                                    labelWidth: 110,
                                    name: 'oplacheno',
                                    value: 0,
                                    fieldStyle: 'font-size:12pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'fieldset',
                                    height: 85,
                                    style: 'background-color: #F1EEEE;',
                                    width: 211,
                                    title: 'В т. ч.',
                                    items: [
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'субсидія',
                                            name: 'subsidia',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true,
                                            decimalPrecision: 3
                                        },
                                        {
                                            xtype: 'numberfield',
                                            anchor: '100%',
                                            fieldLabel: 'пільга',
                                            name: 'lg',
                                            value: 0,
                                            fieldStyle: 'background-color:#F0F8FF;font-size:11pt;text-align:right;',
                                            hideTrigger: true,
                                            autoStripChars: true
                                        }
                                    ]
                                },
                                {
                                    xtype: 'numberfield',
                                    anchor: '100%',
                                    style: 'background-color: #DCDCDC;',
                                    fieldLabel: 'Борг',
                                    labelWidth: 110,
                                    name: 'dolg',
                                    value: 0,
                                    fieldStyle: 'font-size:12pt;text-align:right;',
                                    hideTrigger: true,
                                    autoStripChars: true,
                                    decimalPrecision: 3
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();
                                        var grNach = Ext.getCmp('grNachKvartplata');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        grNach.getView().getSelectionModel().clearSelections();
                                        grNach.getView().getSelectionModel().select(ind);
                                    },
                                    anchor: '20%',
                                    formBind: true,
                                    id: 'btnKvartplataAppReset',
                                    width: '',
                                    icon: 'resources/css/images/ico/refresh.png',
                                    scale: 'medium',
                                    text: '',
                                    tooltip: 'Восстановить'
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        var form = button.findParentByType('form').getForm();
                                        var zadol = form.findField('zadol').getValue();
                                        var rzadol = form.findField('rzadol').getValue();
                                        var fzadol = form.findField('fzadol').getValue();
                                        var dzadol = form.findField('dzadol').getValue();

                                        var tarif = form.findField('tarif').getValue();
                                        var square = form.findField('square').getValue();
                                        var dop = form.findField('dop').getValue();
                                        var remont = form.findField('remont').getValue();

                                        var perer = form.findField('perer').getValue();
                                        var budjet = form.findField('budjet').getValue();
                                        var pbudjet = form.findField('pbudjet').getValue();
                                        var oplacheno = form.findField('oplacheno').getValue();
                                        var roplacheno = form.findField('roplacheno').getValue();
                                        var foplacheno = form.findField('foplacheno').getValue();
                                        var doplacheno = form.findField('doplacheno').getValue();

                                        var nachisleno =0;
                                        var kvartplata = 0;
                                        function roundNumber(rnum, rlength)    {
                                            var newnumber = Math.round(rnum * Math.pow(10, rlength)) / Math.pow(10, rlength);
                                            return newnumber;
                                        }
                                        if ((tarif===0)  &&  square > 0 ) {

                                            Ext.MessageBox.show({
                                                title: 'Проверка тарифа',
                                                msg: 'Введите тариф по услуге',
                                                buttons: Ext.MessageBox.OK,
                                                icon: Ext.MessageBox.INFO
                                            });
                                        } else {
                                            kvartplata = Math.ceil(roundNumber(parseFloat(square) * parseFloat(tarif),3) * 100)/100;
                                            nachisleno =kvartplata  +  perer +  dop   ;
                                            form.findField('kvartplata').setValue(kvartplata);
                                            form.findField('nachisleno').setValue(nachisleno);
                                            form.findField('dolg').setValue(zadol + nachisleno - oplacheno);
                                            form.findField('rdolg').setValue(rzadol + remont - roplacheno);
                                            form.findField('fdolg').setValue(fzadol - foplacheno);
                                            form.findField('ddolg').setValue(dzadol - doplacheno);




                                        }
                                    },
                                    anchor: '20%',
                                    formBind: true,
                                    id: 'btnKvartplataAppPerer',
                                    icon: 'resources/css/images/ico/schet.png',
                                    scale: 'medium',
                                    text: '',
                                    tooltip: 'Просчитать'
                                },
                                {
                                    xtype: 'button',
                                    handler: function(button, e) {
                                        // in use
                                        var me = this;

                                        //STORE
                                        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            address_id:values.get('address_id'),
                                            what:'AppKvartplataIns'
                                        };
                                        //FORMA
                                        var form = button.findParentByType('form').getForm();
                                        var value = form.getValues();
                                        var grNach = Ext.getCmp('grNachKvartplata');
                                        var record = grNach.getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(record);
                                        Ext.Object.merge(value, params);

                                        QueryAddress.updateRecords(value,function(results){

                                            StTekNachApp.load({
                                                params: {
                                                    what:'KvartplataApp',
                                                    address_id: values.get('address_id'),
                                                    login:values.get('login'),
                                                    password:values.get('password')
                                                },
                                                callback: function(records,operation,success){
                                                    if(success){
                                                        grNach.getView().getSelectionModel().select(ind);
                                                    }else{
                                                        form.reset();
                                                    }
                                                },
                                                scope:this
                                            });
                                        });

                                    },
                                    anchor: '60%',
                                    formBind: true,
                                    id: 'btnKvartplataAppIns',
                                    width: 130,
                                    icon: 'resources/css/images/ico/yes22.png',
                                    scale: 'medium',
                                    text: 'Записать'
                                }
                            ]
                        },
                        {
                            xtype: 'button',
                            x: 265,
                            y: 350,
                            id: 'printRaspechatakaKvartplata',
                            width: 190,
                            icon: 'resources/css/images/ico/printer24.png',
                            scale: 'medium',
                            text: 'Расчетный листок'
                        },
                        {
                            xtype: 'button',
                            x: 455,
                            y: 350,
                            id: 'printWarning',
                            width: 190,
                            icon: 'resources/css/images/ico/printer24.png',
                            scale: 'medium',
                            text: 'Предупреждение'
                        },
                        {
                            xtype: 'textfield',
                            x: 260,
                            y: 180,
                            style: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                            width: 385,
                            fieldLabel: 'инфо льгота',
                            name: 'msq_lgota',
                            fieldStyle: 'background-color:#F0F8FF;font-size:10pt;'
                        }
                    ]
                },
                {
                    xtype: 'gridpanel',
                    x: 5,
                    y: 555,
                    id: 'grLgotaNachKvartplata',
                    scrollable: true,
                    width: 895,
                    title: 'нарахування на бюджет',
                    store: 'StLgotaNachVoda',
                    viewConfig: {
                        emptyText: 'Начислений по льготе нет'
                    },
                    columns: [
                        {
                            xtype: 'actioncolumn',
                            width: 30,
                            menuDisabled: true,
                            items: [
                                {
                                    getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                        var pr = r.get('pr');
                                        if (pr === 0 ) {
                                            metaData = 'x-grid-center-icon';
                                        } else if (pr === 1   ){
                                            metaData = 'x-hide-display';
                                        }
                                        return metaData;
                                    },
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        var dt = new Date();
                                        var winAddLgotaPerer = Ext.ClassManager.instantiateByAlias('widget.winaddlgotaperer');
                                        var form = winAddLgotaPerer.down('#fmAddLgotaPerer');
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var value = record;
                                        var rbgTypeNachVoda = winAddLgotaPerer.down('#rbgTypeNachVoda');
                                        rbgTypeNachVoda.hide();
                                        view.getSelectionModel().select(rowIndex);
                                        values.set({'vibor':'addLgotaKvartplataPerer'});
                                        stUser.sync();
                                        form.loadRecord(value);
                                        form.getForm().findField('summa').setValue(value.get('budjet'));
                                        form.getForm().findField('data').setValue(Ext.Date.format(dt, 'Y-m-d'));
                                        form.getForm().findField('m2').hide();
                                        form.getForm().findField('gkm2').hide();
                                        winAddLgotaPerer.show();

                                    },
                                    icon: 'resources/css/images/ico/add.png',
                                    tooltip: 'Добавить перерасчет по льготе'
                                },
                                {
                                    getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                        var tekd = r.get('data');
                                        var dt = new Date();
                                        var check_date=Ext.Date.format(dt, 'Y-m');
                                        var tek_date=Ext.Date.format(tekd, 'Y-m');
                                        var pr = r.get('pr');

                                        if (pr === 0 ) {
                                            metaData = 'x-hide-display';
                                        } else if ((pr === 1) && (check_date === tek_date) ){
                                            metaData = 'x-grid-center-icon';
                                        }
                                        return metaData;
                                    },
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        // in use
                                        var me = this;
                                        //STORE

                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");

                                        var form = Ext.getCmp('fmInfoNachApp');

                                        //LOGIN & PASSWORD
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            address_id:values.get('address_id'),
                                            address:values.get('address'),
                                            what:"delLgotaKvartplataPerer"
                                        };

                                        //GRID
                                        var store = view.getStore();
                                        var value = store.getAt(rowIndex).data;
                                        // FORM

                                        //GRID
                                        var grNach = Ext.getCmp('grNachKvartplata');
                                        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

                                        //LOGIKA


                                        Ext.Object.merge(value, params);
                                        //console.log(value);

                                        Ext.MessageBox.confirm({
                                            title: 'Удаление записи из базы льгот',
                                            msg: 'Вы удаляете перерасчет по квартплате на бюджет <br> Подтвердите или отмените свои действия.',
                                            buttons: Ext.MessageBox.OKCANCEL,
                                            icon: Ext.MessageBox.ERROR,
                                            buttonText:{
                                                ok:'подтвеждаю',
                                                cancel:'отмена'
                                            },
                                            fn:function(btn,newValue){
                                                if(btn=='ok'){
                                                    QueryAddress.updateRecords(value,function(results){
                                                        if(results.success==="1"){
                                                            Ext.MessageBox.show({
                                                                title: 'Удаление перерасчета по квартплате на бюджет',
                                                                msg: results.msg,
                                                                buttons: Ext.MessageBox.OK,
                                                                icon: Ext.MessageBox.INFO
                                                            });
                                                            StTekNachApp.load({
                                                                params: {
                                                                    what:'KvartplataApp',
                                                                    address_id: values.get('address_id'),
                                                                    login:values.get('login'),
                                                                    password:values.get('password')
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        grNach.getView().getSelectionModel().select(ind);
                                                                    }else{
                                                                        form.getForm().reset();
                                                                    }
                                                                },
                                                                scope:this
                                                            });

                                                        } else {
                                                            Ext.MessageBox.show({
                                                                title: 'Удаление перерасчета по квартплате на бюджет',
                                                                msg: results.msg,
                                                                buttons: Ext.MessageBox.OK,
                                                                icon: Ext.MessageBox.ERROR
                                                            });
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    },
                                    icon: 'resources/css/images/ico/delete.png',
                                    tooltip: 'Удалить перерасчет по льготе'
                                }
                            ]
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'lgota_id',
                            text: 'льгота_ид'
                        },
                        {
                            xtype: 'datecolumn',
                            width: 75,
                            dataIndex: 'sdata',
                            menuDisabled: true,
                            text: 'дата с',
                            format: 'd-m-y'
                        },
                        {
                            xtype: 'datecolumn',
                            width: 75,
                            dataIndex: 'fdata',
                            menuDisabled: true,
                            text: 'дата по',
                            format: 'd-m-y'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 120,
                            dataIndex: 'fio',
                            menuDisabled: true,
                            text: 'Ф.И.О'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 130,
                            dataIndex: 'lgota',
                            menuDisabled: true,
                            text: 'Льгота',
                            tooltip: 'name'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 42,
                            align: 'center',
                            dataIndex: 'percent',
                            menuDisabled: true,
                            text: '%',
                            format: '0'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 51,
                            align: 'center',
                            dataIndex: 'people',
                            menuDisabled: true,
                            text: 'чел',
                            format: '0'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 68,
                            align: 'right',
                            dataIndex: 'tarif',
                            menuDisabled: true,
                            text: 'тариф',
                            format: '0.000'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 63,
                            align: 'right',
                            dataIndex: 'qty',
                            menuDisabled: true,
                            text: 'S (м&sup2;)'
                        },
                        {
                            xtype: 'numbercolumn',
                            summaryType: 'sum',
                            width: 74,
                            align: 'right',
                            dataIndex: 'budjet',
                            menuDisabled: true,
                            text: 'Cумма'
                        },
                        {
                            xtype: 'numbercolumn',
                            width: 40,
                            dataIndex: 'pr',
                            menuDisabled: true,
                            text: 'пр',
                            format: '0'
                        },
                        {
                            xtype: 'actioncolumn',
                            width: 30,
                            menuDisabled: true,
                            items: [
                                {
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        var dt = new Date();
                                        var winAddLgotaPerer = Ext.ClassManager.instantiateByAlias('widget.winaddlgotaperer');
                                        var form = winAddLgotaPerer.down('#fmAddLgotaPerer');
                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var values =stUser.getAt(0);
                                        var value = record;

                                        view.getSelectionModel().select(rowIndex);
                                        values.set({'vibor':'editLgotaKvartplata'});
                                        stUser.sync();

                                        form.down('#btAddLgotaPerer').setText('Обновить запись');
                                        form.loadRecord(value);
                                        form.getForm().findField('summa').setValue(value.get('budjet'));
                                        form.getForm().findField('m2').hide();
                                        form.getForm().findField('gkm2').hide();
                                        winAddLgotaPerer.setTitle('Редактирование записи на бюджет');

                                        winAddLgotaPerer.show();
                                    },
                                    icon: 'resources/css/images/ico/edit.png',
                                    tooltip: 'Редактировать запись'
                                }
                            ]
                        },
                        {
                            xtype: 'actioncolumn',
                            width: 30,
                            menuDisabled: true,
                            items: [
                                {
                                    getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                        var tekd = r.get('data');
                                        var dt = new Date();
                                        var check_date=Ext.Date.format(dt, 'Y-m');
                                        var tek_date=Ext.Date.format(tekd, 'Y-m');
                                        var pr = r.get('pr');
                                        if (pr === 1 ) {
                                            metaData = 'x-hide-display';
                                        } else if ( (pr === 0)  ){
                                            metaData = 'x-grid-center-icon';
                                        }
                                        return metaData;
                                    },
                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                        // in use
                                        var me = this;
                                        //STORE

                                        var stUser = Ext.data.StoreManager.get("StUser");
                                        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");

                                        var form = Ext.getCmp('fmInfoNachApp');

                                        //LOGIN & PASSWORD
                                        var values =stUser.getAt(0);
                                        var params = {
                                            login:values.get('login'),
                                            password:values.get('password'),
                                            address_id:values.get('address_id'),
                                            address:values.get('address'),
                                            what:"delLgotaKvartplata"
                                        };

                                        //GRID
                                        var store = view.getStore();
                                        var value = store.getAt(rowIndex).data;
                                        // FORM

                                        //GRID
                                        var grNach = Ext.getCmp('grNachKvartplata');
                                        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
                                        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

                                        //LOGIKA


                                        Ext.Object.merge(value, params);
                                        //console.log(value);

                                        Ext.MessageBox.confirm({
                                            title: 'Удаление записи из базы льгот',
                                            msg: 'Вы удаляете начисление на бюджет <br> Подтвердите или отмените свои действия.',
                                            buttons: Ext.MessageBox.OKCANCEL,
                                            icon: Ext.MessageBox.ERROR,
                                            buttonText:{
                                                ok:'подтвеждаю',
                                                cancel:'отмена'
                                            },
                                            fn:function(btn,newValue){
                                                if(btn=='ok'){
                                                    QueryAddress.updateRecords(value,function(results){
                                                        if(results.success==="1"){
                                                            Ext.MessageBox.show({
                                                                title: 'Удаление начисления по воде на бюджет',
                                                                msg: results.msg,
                                                                buttons: Ext.MessageBox.OK,
                                                                icon: Ext.MessageBox.INFO
                                                            });
                                                            StTekNachApp.load({
                                                                params: {
                                                                    what:'KvartplataApp',
                                                                    address_id: values.get('address_id'),
                                                                    login:values.get('login'),
                                                                    password:values.get('password')
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        grNach.getView().getSelectionModel().select(ind);
                                                                    }else{
                                                                        form.getForm().reset();
                                                                    }
                                                                },
                                                                scope:this
                                                            });

                                                        } else {
                                                            Ext.MessageBox.show({
                                                                title: 'Удаление начисления по воде на бюджет',
                                                                msg: results.msg,
                                                                buttons: Ext.MessageBox.OK,
                                                                icon: Ext.MessageBox.ERROR
                                                            });
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    },
                                    icon: 'resources/css/images/ico/no.png',
                                    tooltip: 'Удалить  запись '
                                }
                            ]
                        },
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'info',
                            menuDisabled: true,
                            text: 'инфо',
                            tooltip: 'name'
                        }
                    ],
                    features: [
                        {
                            ftype: 'summary'
                        }
                    ],
                    tools: [
                        {
                            xtype: 'tool',
                            callback: function(owner, tool, event) {
                                var gridLgotnik = Ext.getCmp('grLgotnikNachApp');
                                var gridNachisl = Ext.getCmp('grNachKvartplata');
                                var stUser = Ext.data.StoreManager.get("StUser");
                                var values =stUser.getAt(0);
                                var value  = gridLgotnik.getView().getSelectionModel().getSelection()[0];
                                var valueNachisl  = gridNachisl.getView().getSelectionModel().getSelection()[0];
                                var ind  = gridNachisl.getView().getStore().indexOf(valueNachisl);

                                //console.log(valueNachisl.index);
                                if (value !==undefined && valueNachisl !==undefined ){
                                    var winAddLgotaPerer = Ext.ClassManager.instantiateByAlias('widget.winaddlgotaperer');
                                    var form = winAddLgotaPerer.down('#fmAddLgotaPerer');
                                    var rbgTypeNachVoda = winAddLgotaPerer.down('#rbgTypeNachVoda');
                                    var dt = new Date();
                                    var dt_nach = new Date(valueNachisl.get('data'));
                                    var check_date = Ext.Date.format(dt, 'Y-m');
                                    var date_check = Ext.Date.format(dt_nach, 'Y-m');
                                    form.getForm().findField('m2').hide();
                                    form.getForm().findField('gkm2').hide();
                                    rbgTypeNachVoda.hide();
                                    winAddLgotaPerer.setTitle('Добавление записи на бюджет');

                                    var pr = form.getForm().findField('checkType').getValue();
                                    //console.log(pr);

                                    if (pr === true ) {

                                        values.set({'vibor':'addLgotaKvartplata'});
                                        stUser.sync();
                                        form.loadRecord(value);
                                        form.getForm().findField('data').setValue(Ext.Date.format(dt, 'Y-m-d'));
                                        form.getForm().findField('sdata').setValue(Ext.Date.getFirstDateOfMonth(dt) );
                                        form.getForm().findField('fdata').setValue(Ext.Date.getLastDateOfMonth(dt) );
                                        form.getForm().findField('tarif').setValue(valueNachisl.get('tarif'));
                                        form.getForm().findField('qty').setValue(valueNachisl.get('square_lg'));
                                        form.getForm().findField('summa').setValue(valueNachisl.get('budjet'));
                                        form.getForm().findField('checkType').setValue("0");
                                        form.getForm().findField('info').setValue('Добавление записи начисления на бюджет в ручном режиме');
                                        form.getForm().findField('ind').setValue(ind);
                                        winAddLgotaPerer.show();

                                    } else {

                                        values.set({'vibor':'addLgotaKvartplataPerer'});
                                        stUser.sync();
                                        form.loadRecord(value);
                                        form.getForm().findField('data').setValue(Ext.Date.format(dt, 'Y-m-d'));
                                        form.getForm().findField('sdata').setValue(Ext.Date.getFirstDateOfMonth(dt_nach) );
                                        form.getForm().findField('fdata').setValue(Ext.Date.getLastDateOfMonth(dt_nach) );
                                        form.getForm().findField('tarif').setValue(valueNachisl.get('tarif'));
                                        form.getForm().findField('qty').setValue(valueNachisl.get('square_lg'));
                                        form.getForm().findField('summa').setValue(valueNachisl.get('budjet'));
                                        form.getForm().findField('checkType').setValue("1");
                                        form.getForm().findField('info').setValue('Добавление записи перерасчета на бюджет в ручном режиме');
                                        form.getForm().findField('ind').setValue(ind);
                                        winAddLgotaPerer.show();

                                    }


                                } else{
                                    Ext.MessageBox.show({
                                        title: 'Добавлениезаписи начисления  на бюджет',
                                        msg: 'Не выбран льготчик',
                                        buttons: Ext.MessageBox.OK,
                                        icon: Ext.MessageBox.INFO
                                    });
                                }
                            },
                            tooltip: 'добавить начисление по льготнику',
                            type: 'plus'
                        }
                    ]
                }
            ]
        }
    ],

    onCheckboxfieldChange31: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Так");
        }else{
            field.setBoxLabel("Ні");
        }
    },

    onCheckboxfieldChange21: function(field, newValue, oldValue, eOpts) {
        if(newValue){
            field.setBoxLabel("Так");
        }else{
            field.setBoxLabel("Ні");
        }
    }

});