/*
 * File: app/view/sprav/TabKvartplata.js
 * Date: Thu May 21 2020 23:28:13 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Osmd.view.sprav.TabKvartplata', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.tabkvartplata',

    requires: [
        'Osmd.view.sprav.TabKvartplataViewModel',
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.view.Table',
        'Ext.toolbar.Toolbar',
        'Ext.form.field.ComboBox',
        'Ext.form.field.Number',
        'Ext.button.Button',
        'Ext.selection.CheckboxModel',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.panel.Tool',
        'Ext.form.FieldSet',
        'Ext.form.field.Date',
        'Ext.form.field.Checkbox',
        'Ext.form.field.TextArea'
    ],

    viewModel: {
        type: 'tabkvartplata'
    },
    height: 766,
    id: 'tabKvartplata',
    scrollable: true,
    width: 1074,
    layout: 'fit',
    bodyBorder: false,
    closable: true,
    title: 'Квартплата',
    defaultListenerScope: true,

    initConfig: function(instanceConfig) {
        var me = this,
            config = {
                items: [
                    {
                        xtype: 'form',
                        id: 'fmKvartplata',
                        scrollable: true,
                        title: '',
                        items: [
                            {
                                xtype: 'gridpanel',
                                anchor: '100%',
                                id: 'grTarifHousesKv',
                                padding: 10,
                                scrollable: true,
                                width: 900,
                                bodyBorder: true,
                                title: 'Дома',
                                store: 'StTarif',
                                viewConfig: {
                                    getRowClass: function(record, rowIndex, rowParams, store) {
                                        if(record.get('pr') === "0" ){
                                            return 'change_color_yellow';

                                        } else  {
                                            return  'change_color_green';
                                        }
                                    }
                                },
                                dockedItems: [
                                    {
                                        xtype: 'toolbar',
                                        dock: 'top',
                                        items: [
                                            {
                                                xtype: 'combobox',
                                                width: 220,
                                                fieldLabel: 'Дом',
                                                labelWidth: 45,
                                                name: 'id_house',
                                                displayField: 'house',
                                                queryMode: 'local',
                                                store: 'StHousesOrg',
                                                valueField: 'house_id',
                                                listeners: {
                                                    select: 'onComboboxSelect211'
                                                }
                                            },
                                            {
                                                xtype: 'combobox',
                                                id: 'cbTarifKv',
                                                width: 220,
                                                fieldLabel: 'услуга',
                                                labelWidth: 50,
                                                name: 'viborTarif',
                                                displayField: 'usluga',
                                                queryMode: 'local',
                                                store: 'StKvTarif',
                                                valueField: 'tarif',
                                                listeners: {
                                                    select: 'onCbTarifKvSelect'
                                                }
                                            },
                                            {
                                                xtype: 'numberfield',
                                                id: 'tarKv',
                                                width: 200,
                                                fieldLabel: 'значение',
                                                labelWidth: 80,
                                                name: 'tar',
                                                value: 0,
                                                fieldStyle: 'background-color:#F0F8FF;font-size:10pt;text-align:right;',
                                                hideTrigger: true,
                                                decimalPrecision: 3
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, event) {
                                                    var form = button.findParentByType('form');
                                                    var  id_house = form.getForm().findField('id_house').getValue();

                                                    //console.log(id_house);

                                                    var btnInsTarif = Ext.getCmp('btnInsTarifKv');
                                                    var tarif = Ext.getCmp('tarKv');
                                                    var viborTarif = Ext.getCmp('cbTarifKv');
                                                    var stUser = Ext.data.StoreManager.get("StUser");
                                                    var StTarif = Ext.data.StoreManager.get("StTarif");
                                                    var grid =  Ext.getCmp('grTarifHousesKv');
                                                    var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
                                                    var size = Ext.Object.getSize(gridRowSelectedRecords) ;
                                                    var values =stUser.getAt(0);
                                                    var login = values.get('login');
                                                    var password = values.get('password');
                                                    var myMask= Ext.Msg.show({
                                                        title:'Тариф...',
                                                        msg: 'Изменение тарифа.Ожидайте...',
                                                        buttons: Ext.Msg.CANCEL,
                                                        wait: true,
                                                        modal: true,
                                                        icon: Ext.Msg.INFO
                                                    });
                                                    var params =[];
                                                    if (size >= 1){
                                                        params = {
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            what:"vvod_tarif_kv",
                                                            name_tar:viborTarif.getValue(),
                                                            new_tar:tarif.getValue()
                                                        };
                                                        Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
                                                            Ext.Object.merge(val.data, params);
                                                            QueryAddress.updateRecords(val.data,function(results){
                                                                if(results.res){
                                                                    return  true;
                                                                }  else {
                                                                    return  false;
                                                                }
                                                            });

                                                        });
                                                        if(id_house == "188"){
                                                            StTarif.load({
                                                                params: {
                                                                    what:'TarifFromHouses',
                                                                    login:login,
                                                                    password:password
                                                                    //data:data,
                                                                    //house_id: record.get('house_id')
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        viborTarif.clearValue();
                                                                        viborTarif.setDisabled(true);
                                                                        tarif.setValue(0);
                                                                        tarif.setDisabled(true);
                                                                        btnInsTarif.setDisabled(true);

                                                                    }
                                                                },
                                                                scope:this
                                                            });
                                                        } else {

                                                            StTarif.load({
                                                                params: {
                                                                    what:'TarifFromHouse',
                                                                    login:login,
                                                                    password:password,
                                                                    //data:data,
                                                                    house_id: id_house
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        viborTarif.clearValue();
                                                                        viborTarif.setDisabled(true);
                                                                        tarif.setValue(0);
                                                                    }
                                                                },
                                                                scope:this
                                                            });
                                                        }
                                                        myMask.close();
                                                    } else {
                                                        myMask.close();
                                                        Ext.MessageBox.show({
                                                            title: 'Ошибка ',
                                                            msg: 'Не выбраны дома  для начисления',
                                                            buttons: Ext.MessageBox.OK,
                                                            icon: Ext.MessageBox.ERROR
                                                        });
                                                    }

                                                },
                                                disabled: true,
                                                id: 'btnInsTarifKv',
                                                width: 135,
                                                icon: 'resources/css/images/ico/yes.png',
                                                text: 'Записать '
                                            }
                                        ]
                                    }
                                ],
                                selModel: Ext.create('Ext.selection.CheckboxModel', {
                                    selType: 'checkboxmodel',
                                    showHeaderCheckbox: true
                                }),
                                columns: [
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Дом',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                width: 43,
                                                dataIndex: 'house_id',
                                                menuDisabled: true,
                                                text: 'ид',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'datecolumn',
                                                width: 80,
                                                align: 'center',
                                                dataIndex: 'data',
                                                menuDisabled: true,
                                                text: 'дата',
                                                format: 'F,y'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 137,
                                                dataIndex: 'house',
                                                menuDisabled: true,
                                                text: 'Дом'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 35,
                                                dataIndex: 'floor',
                                                menuDisabled: true,
                                                text: 'Эт',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 60,
                                                dataIndex: 'dop',
                                                menuDisabled: true,
                                                text: 'Допол',
                                                format: '0.00'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 60,
                                                dataIndex: 'remont',
                                                menuDisabled: true,
                                                text: 'Рем',
                                                format: '0.00'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Квартплата дома до 12эт',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                text: '1 этаж',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv9f1',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv9f1',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                text: '2й и выше',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv9',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv9',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Квартплата дома свыше 12эт',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                text: '1 этаж',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv16f1',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv16f1',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                text: '2й и выше',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv16',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv16',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Тариф для льготников',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                text: '1 этаж',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'lgf1',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                text: '2й и выше',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'lg',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        hidden: true,
                                        dataIndex: 'raion',
                                        text: 'Raion'
                                    }
                                ],
                                tools: [
                                    {
                                        xtype: 'tool',
                                        callback: function(owner, tool, event) {
                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var StTarif = Ext.data.StoreManager.get("StTarif");
                                            //LOGIN & PASSWORD
                                            var values =stUser.getAt(0);
                                            var login = values.get('login');
                                            var password = values.get('password');
                                            // FORM
                                            var tarif = Ext.getCmp('tarKv');
                                            var viborTarif = Ext.getCmp('cbTarifKv');
                                            var form = tool.findParentByType('form');
                                            var value = form.getValues();

                                            StTarif.load({
                                                params: {
                                                    what:'TarifFromHouseAll',
                                                    login:login,
                                                    password:password,
                                                    house_id: value.id_house
                                                },
                                                callback: function(records,operation,success){
                                                    if(success){
                                                        viborTarif.clearValue();
                                                        viborTarif.setDisabled(true);
                                                        tarif.setValue(0);
                                                    }
                                                },
                                                scope:this
                                            });

                                        },
                                        type: 'search'
                                    }
                                ]
                            },
                            {
                                xtype: 'panel',
                                anchor: '100%',
                                height: 538,
                                padding: 10,
                                layout: 'fit',
                                animCollapse: true,
                                title: 'Начисление и перерасчет по электроэнергии',
                                titleCollapse: true,
                                items: [
                                    {
                                        xtype: 'fieldset',
                                        height: 262,
                                        padding: '',
                                        style: 'background-color: #DCDCDC;',
                                        width: 900,
                                        layout: 'absolute',
                                        title: '',
                                        items: [
                                            {
                                                xtype: 'datefield',
                                                x: 15,
                                                y: 10,
                                                width: 267,
                                                fieldLabel: 'Период начисления',
                                                labelWidth: 130,
                                                name: 'data_nach',
                                                readOnly: true,
                                                format: 'F,Y',
                                                startDay: 1,
                                                submitFormat: 'Ymd'
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, e) {
                                                    var form = button.findParentByType('form');
                                                    var  id_house = form.getForm().findField('id_house').getValue();

                                                    //console.log(id_house);

                                                    var btnInsTarif = Ext.getCmp('btnInsTarifKv');
                                                    var tarif = Ext.getCmp('tarKv');
                                                    var viborTarif = Ext.getCmp('cbTarifKv');
                                                    var stUser = Ext.data.StoreManager.get("StUser");
                                                    var StTarif = Ext.data.StoreManager.get("StTarif");
                                                    var grid =  Ext.getCmp('grTarifHousesKv');
                                                    var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
                                                    var size = Ext.Object.getSize(gridRowSelectedRecords) ;
                                                    var values =stUser.getAt(0);
                                                    var login = values.get('login');
                                                    var password = values.get('password');
                                                    var myMask= Ext.Msg.show({
                                                        title:'Начисление...',
                                                        msg: 'Начисление услуги.Ожидайте...',
                                                        buttons: Ext.Msg.CANCEL,
                                                        wait: true,
                                                        modal: true,
                                                        icon: Ext.Msg.INFO
                                                    });
                                                    var params =[];
                                                    if (size >= 1){
                                                        params = {
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            what:"nachislenie_kvartplata_now"

                                                        };
                                                        Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
                                                            Ext.Object.merge(val.data, params);
                                                            QueryAddress.updateRecords(val.data,function(results){
                                                                if(results.res){
                                                                    return  true;
                                                                }  else {
                                                                    return  false;
                                                                }
                                                            });

                                                        });
                                                        if(id_house == "188"){
                                                            StTarif.load({
                                                                params: {
                                                                    what:'TarifFromHouses',
                                                                    login:login,
                                                                    password:password
                                                                    //data:data,
                                                                    //house_id: record.get('house_id')
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        viborTarif.clearValue();
                                                                        viborTarif.setDisabled(true);
                                                                        tarif.setValue(0);
                                                                        tarif.setDisabled(true);
                                                                        btnInsTarif.setDisabled(true);

                                                                    }
                                                                },
                                                                scope:this
                                                            });
                                                        } else {

                                                            StTarif.load({
                                                                params: {
                                                                    what:'TarifFromHouse',
                                                                    login:login,
                                                                    password:password,
                                                                    //data:data,
                                                                    house_id: id_house
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        viborTarif.clearValue();
                                                                        viborTarif.setDisabled(true);
                                                                        tarif.setValue(0);
                                                                    }
                                                                },
                                                                scope:this

                                                            });
                                                        }
                                                        myMask.close();
                                                    } else {
                                                        myMask.close();
                                                        Ext.MessageBox.show({
                                                            title: 'Ошибка ',
                                                            msg: 'Не выбраны дома  для начисления',
                                                            buttons: Ext.MessageBox.OK,
                                                            icon: Ext.MessageBox.ERROR
                                                        });
                                                    }

                                                },
                                                x: 300,
                                                y: 10,
                                                formBind: false,
                                                disabled: true,
                                                id: 'btAddNachKv',
                                                width: 285,
                                                icon: 'resources/css/images/ico/add.png',
                                                text: 'начислить квартплату за период'
                                            },
                                            {
                                                xtype: 'fieldset',
                                                x: 15,
                                                y: 60,
                                                height: 385,
                                                style: 'background-color: #F1EEEE ;',
                                                width: 990,
                                                layout: 'absolute',
                                                title: 'Перерасчет',
                                                items: [
                                                    {
                                                        xtype: 'checkboxfield',
                                                        x: 5,
                                                        y: 5,
                                                        fieldLabel: 'тарифы установлены вручную',
                                                        labelWidth: 250,
                                                        name: 'tarif_manual',
                                                        boxLabel: '',
                                                        inputValue: '1',
                                                        uncheckedValue: '0'
                                                    },
                                                    {
                                                        xtype: 'fieldset',
                                                        x: 10,
                                                        y: 40,
                                                        height: 125,
                                                        style: 'background-color: #DCDCDC;',
                                                        width: 360,
                                                        title: 'дома до 12 этажей',
                                                        layout: {
                                                            type: 'hbox',
                                                            align: 'stretch'
                                                        },
                                                        items: [
                                                            {
                                                                xtype: 'fieldset',
                                                                height: 91,
                                                                style: 'background-color: #F1EEEE ;',
                                                                width: 172,
                                                                title: '1этаж',
                                                                items: [
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'действ',
                                                                        labelWidth: 50,
                                                                        name: 'kv9f1',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    },
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'новый',
                                                                        labelWidth: 50,
                                                                        name: 'ch_kv9f1',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                xtype: 'fieldset',
                                                                height: 91,
                                                                style: 'background-color: #F1EEEE ;',
                                                                width: 163,
                                                                title: '2й этаж и выше',
                                                                items: [
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'действ',
                                                                        labelWidth: 50,
                                                                        name: 'kv9',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    },
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'новый',
                                                                        labelWidth: 50,
                                                                        name: 'ch_kv9',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'fieldset',
                                                        x: 380,
                                                        y: 40,
                                                        height: 125,
                                                        style: 'background-color: #DCDCDC;',
                                                        width: 380,
                                                        title: 'дома свыше 12 этажей',
                                                        layout: {
                                                            type: 'hbox',
                                                            align: 'stretch'
                                                        },
                                                        items: [
                                                            {
                                                                xtype: 'fieldset',
                                                                height: 91,
                                                                style: 'background-color: #F1EEEE ;',
                                                                width: 167,
                                                                title: '1этаж',
                                                                items: [
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'действ',
                                                                        labelWidth: 50,
                                                                        name: 'kv16f1',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    },
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'новый',
                                                                        labelWidth: 50,
                                                                        name: 'ch_kv16f1',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    }
                                                                ]
                                                            },
                                                            {
                                                                xtype: 'fieldset',
                                                                height: 91,
                                                                style: 'background-color: #F1EEEE ;',
                                                                width: 165,
                                                                title: '2й этаж и выше',
                                                                items: [
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'действ',
                                                                        labelWidth: 50,
                                                                        name: 'kv16',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    },
                                                                    {
                                                                        xtype: 'numberfield',
                                                                        width: 130,
                                                                        fieldLabel: 'новый',
                                                                        labelWidth: 50,
                                                                        name: 'ch_kv16',
                                                                        hideTrigger: true,
                                                                        decimalPrecision: 3
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'textareafield',
                                                        x: 270,
                                                        y: 235,
                                                        width: 465,
                                                        fieldLabel: 'Инфо перер',
                                                        name: 'info'
                                                    },
                                                    {
                                                        xtype: 'checkboxfield',
                                                        handler: function(checkbox, checked) {
                                                            var form = checkbox.findParentByType('form');
                                                            var  address_ot = form.getForm().findField('address_ot');
                                                            var  address_do = form.getForm().findField('address_do');

                                                            if(checked===true){
                                                                if (address_ot.isVisible()) address_ot.hide();
                                                                if (address_do.isVisible()) address_do.hide();
                                                            } else {
                                                                if (address_ot.isHidden()) address_ot.show();
                                                                if (address_do.isHidden()) address_do.show();

                                                            }
                                                        },
                                                        x: 30,
                                                        y: 180,
                                                        fieldLabel: 'По всем квартирам дома',
                                                        labelWidth: 200,
                                                        name: 'allkv',
                                                        boxLabel: '',
                                                        checked: true,
                                                        inputValue: '1',
                                                        uncheckedValue: '0'
                                                    },
                                                    {
                                                        xtype: 'fieldset',
                                                        x: 30,
                                                        y: 220,
                                                        height: 85,
                                                        style: 'background-color: #DCDCDC;',
                                                        width: 195,
                                                        title: 'Период перерасчета',
                                                        items: [
                                                            {
                                                                xtype: 'datefield',
                                                                anchor: '100%',
                                                                width: 185,
                                                                fieldLabel: 'Дата с',
                                                                labelWidth: 60,
                                                                name: 'sdata',
                                                                format: 'd-m-Y',
                                                                submitFormat: 'Ymd'
                                                            },
                                                            {
                                                                xtype: 'datefield',
                                                                anchor: '100%',
                                                                width: 185,
                                                                fieldLabel: 'Дата по',
                                                                labelWidth: 60,
                                                                name: 'fdata',
                                                                format: 'd-m-Y',
                                                                submitFormat: 'Ymd'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        xtype: 'combobox',
                                                        x: 530,
                                                        y: 180,
                                                        hidden: true,
                                                        style: 'background-color: #C2D9E9;',
                                                        width: 200,
                                                        fieldLabel: 'по',
                                                        labelWidth: 20,
                                                        name: 'address_do',
                                                        editable: false,
                                                        displayField: 'address',
                                                        forceSelection: true,
                                                        queryMode: 'local',
                                                        store: 'StAddressOrg',
                                                        valueField: 'address_id'
                                                    },
                                                    {
                                                        xtype: 'combobox',
                                                        x: 300,
                                                        y: 180,
                                                        hidden: true,
                                                        style: 'background-color: #C2D9E9;',
                                                        width: 200,
                                                        fieldLabel: 'c',
                                                        labelWidth: 20,
                                                        name: 'address_ot',
                                                        enableKeyEvents: true,
                                                        displayField: 'address',
                                                        forceSelection: true,
                                                        queryMode: 'local',
                                                        store: 'StAddressOrg',
                                                        valueField: 'address_id'
                                                    },
                                                    {
                                                        xtype: 'button',
                                                        handler: function(button, e) {
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var grid =  Ext.getCmp('grTarifHousesKv');
                                                            var value = button.findParentByType('form').getValues();

                                                            var house_id = value.id_house;
                                                            //console.log(house_id);

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:"nachislenie_kvartplata",
                                                                house_id:house_id
                                                            };

                                                            params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:"pereraschet_kvartplata",
                                                                house_id:house_id,
                                                                kv9f1:value.kv9f1,
                                                                kv9:value.kv9,
                                                                ch_kv9f1:value.ch_kv9f1,
                                                                ch_kv9:value.ch_kv9,
                                                                kv16f1:value.kv16f1,
                                                                kv16:value.kv16,
                                                                ch_kv16f1:value.ch_kv16f1,
                                                                ch_kv16:value.ch_kv16,
                                                                allkv:value.allkv,
                                                                tarif_manual:value.tarif_manual,
                                                                sdata:value.sdata,
                                                                fdata:value.fdata,
                                                                address_ot:value.address_ot,
                                                                address_do:value.address_do,
                                                                info:value.info
                                                            };
                                                            //console.log(params);

                                                            var myMask= Ext.Msg.show({
                                                                title:'Перерасчет...',
                                                                msg: 'Перерасчет квартплаты .Ожидайте...',
                                                                buttons: Ext.Msg.CANCEL,
                                                                wait: true,
                                                                modal: true,
                                                                icon: Ext.Msg.INFO
                                                            });

                                                            QueryAddress.updateRecords(params,function(results){
                                                                if(results.success==="1"){
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Перерасчет квартплаты',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.INFO
                                                                    });
                                                                } else {
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Перерасчет квартплаты',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.ERROR
                                                                    });
                                                                }

                                                            });





                                                        },
                                                        x: 400,
                                                        y: 320,
                                                        disabled: true,
                                                        height: 30,
                                                        id: 'btAddPererKv',
                                                        width: 340,
                                                        icon: 'resources/css/images/ico/add.png',
                                                        text: 'Перерасчитать квартплату за период'
                                                    },
                                                    {
                                                        xtype: 'button',
                                                        handler: function(button, e) {
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var grid =  Ext.getCmp('grTarifHousesKv');
                                                            var value = button.findParentByType('form').getValues();

                                                            var house_id = value.id_house;
                                                            //console.log(house_id);

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:"nachislenie_dop_osmd",
                                                                house_id:house_id
                                                            };

                                                            params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:"nachislenie_dop_osmd",
                                                                house_id:house_id,
                                                                allkv:value.allkv,
                                                                sdata:value.sdata,
                                                                fdata:value.fdata,
                                                                address_ot:value.address_ot,
                                                                address_do:value.address_do,
                                                                info:value.info
                                                            };
                                                            //console.log(params);

                                                            var myMask= Ext.Msg.show({
                                                                title:'Начисление допуслуги...',
                                                                msg: 'Начисление допуслуги .Ожидайте...',
                                                                buttons: Ext.Msg.CANCEL,
                                                                wait: true,
                                                                modal: true,
                                                                icon: Ext.Msg.INFO
                                                            });

                                                            QueryAddress.updateRecords(params,function(results){
                                                                if(results.success==="1"){
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Начисление допуслуги',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.INFO
                                                                    });
                                                                } else {
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Начисление допуслуги',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.ERROR
                                                                    });
                                                                }

                                                            });





                                                        },
                                                        x: 760,
                                                        y: 180,
                                                        disabled: true,
                                                        height: 30,
                                                        id: 'btAddNachDop',
                                                        width: 190,
                                                        icon: 'resources/css/images/ico/add.png',
                                                        text: 'Начислить доп. услугу'
                                                    },
                                                    {
                                                        xtype: 'button',
                                                        handler: function(button, e) {
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var grid =  Ext.getCmp('grTarifHousesKv');
                                                            var value = button.findParentByType('form').getValues();

                                                            var house_id = value.id_house;
                                                            //console.log(house_id);

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:"nachislenie_remont_osmd",
                                                                house_id:house_id
                                                            };

                                                            params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:"nachislenie_remont_osmd",
                                                                house_id:house_id,
                                                                allkv:value.allkv,
                                                                sdata:value.sdata,
                                                                fdata:value.fdata,
                                                                address_ot:value.address_ot,
                                                                address_do:value.address_do,
                                                                info:value.info
                                                            };
                                                            //console.log(params);

                                                            var myMask= Ext.Msg.show({
                                                                title:'Начисление допуслуги...',
                                                                msg: 'Начисление допуслуги .Ожидайте...',
                                                                buttons: Ext.Msg.CANCEL,
                                                                wait: true,
                                                                modal: true,
                                                                icon: Ext.Msg.INFO
                                                            });

                                                            QueryAddress.updateRecords(params,function(results){
                                                                if(results.success==="1"){
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Начисление допуслуги',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.INFO
                                                                    });
                                                                } else {
                                                                    myMask.close();
                                                                    Ext.MessageBox.show({
                                                                        title: 'Начисление допуслуги',
                                                                        msg: results.msg,
                                                                        buttons: Ext.MessageBox.OK,
                                                                        icon: Ext.MessageBox.ERROR
                                                                    });
                                                                }

                                                            });




                                                        },
                                                        x: 760,
                                                        y: 220,
                                                        disabled: true,
                                                        height: 30,
                                                        id: 'btAddNachRemont',
                                                        width: 190,
                                                        icon: 'resources/css/images/ico/add.png',
                                                        text: 'Начислить ремонт'
                                                    },
                                                    {
                                                        xtype: 'button',
                                                        handler: function(button, e) {
                                                            var form = button.findParentByType('form');
                                                            var  id_house = form.getForm().findField('id_house').getValue();

                                                            //console.log(id_house);

                                                            var btnInsTarif = Ext.getCmp('btnInsTarifKv');
                                                            var tarif = Ext.getCmp('tarKv');
                                                            var viborTarif = Ext.getCmp('cbTarifKv');
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var StTarif = Ext.data.StoreManager.get("StTarif");
                                                            var grid =  Ext.getCmp('grTarifHousesKv');
                                                            var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
                                                            var size = Ext.Object.getSize(gridRowSelectedRecords) ;
                                                            var values =stUser.getAt(0);
                                                            var login = values.get('login');
                                                            var password = values.get('password');
                                                            var myMask= Ext.Msg.show({
                                                                title:'Начисление...',
                                                                msg: 'Начисление услуги.Ожидайте...',
                                                                buttons: Ext.Msg.CANCEL,
                                                                wait: true,
                                                                modal: true,
                                                                icon: Ext.Msg.INFO
                                                            });
                                                            var params =[];
                                                            if (size >= 1){
                                                                params = {
                                                                    login:values.get('login'),
                                                                    password:values.get('password'),
                                                                    what:"nachislenie_kvartplata_prev"

                                                                };
                                                                Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
                                                                    Ext.Object.merge(val.data, params);
                                                                    QueryAddress.updateRecords(val.data,function(results){
                                                                        if(results.res){
                                                                            return  true;
                                                                        }  else {
                                                                            return  false;
                                                                        }
                                                                    });

                                                                });
                                                                if(id_house == "188"){
                                                                    StTarif.load({
                                                                        params: {
                                                                            what:'TarifFromHouses',
                                                                            login:login,
                                                                            password:password
                                                                            //data:data,
                                                                            //house_id: record.get('house_id')
                                                                        },
                                                                        callback: function(records,operation,success){
                                                                            if(success){
                                                                                viborTarif.clearValue();
                                                                                viborTarif.setDisabled(true);
                                                                                tarif.setValue(0);
                                                                                tarif.setDisabled(true);
                                                                                btnInsTarif.setDisabled(true);

                                                                            }
                                                                        },
                                                                        scope:this
                                                                    });
                                                                } else {

                                                                    StTarif.load({
                                                                        params: {
                                                                            what:'TarifFromHouse',
                                                                            login:login,
                                                                            password:password,
                                                                            //data:data,
                                                                            house_id: id_house
                                                                        },
                                                                        callback: function(records,operation,success){
                                                                            if(success){
                                                                                viborTarif.clearValue();
                                                                                viborTarif.setDisabled(true);
                                                                                tarif.setValue(0);
                                                                            }
                                                                        },
                                                                        scope:this

                                                                    });
                                                                }
                                                                myMask.close();
                                                            } else {
                                                                myMask.close();
                                                                Ext.MessageBox.show({
                                                                    title: 'Ошибка ',
                                                                    msg: 'Не выбраны дома  для начисления',
                                                                    buttons: Ext.MessageBox.OK,
                                                                    icon: Ext.MessageBox.ERROR
                                                                });
                                                            }

                                                        },
                                                        x: 10,
                                                        y: 320,
                                                        disabled: true,
                                                        height: 30,
                                                        id: 'btAddNachKvPrev',
                                                        width: 350,
                                                        icon: 'resources/css/images/ico/add.png',
                                                        text: 'начислить квартплату за предыдущий период'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'button',
                                                handler: function(button, event) {

                                                    var form = button.findParentByType('form');
                                                    var  id_house = form.getForm().findField('id_house').getValue();

                                                    //console.log(id_house);

                                                    var btnInsTarif = Ext.getCmp('btnInsTarifKv');
                                                    var tarif = Ext.getCmp('tarKv');
                                                    var viborTarif = Ext.getCmp('cbTarifKv');
                                                    var stUser = Ext.data.StoreManager.get("StUser");
                                                    var StTarif = Ext.data.StoreManager.get("StTarif");
                                                    var grid =  Ext.getCmp('grTarifHousesKv');
                                                    var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
                                                    var size = Ext.Object.getSize(gridRowSelectedRecords) ;
                                                    var values =stUser.getAt(0);
                                                    var login = values.get('login');
                                                    var password = values.get('password');
                                                    var myMask= Ext.Msg.show({
                                                        title:'Начисление...',
                                                        msg: 'Начисление услуги.Ожидайте...',
                                                        buttons: Ext.Msg.CANCEL,
                                                        wait: true,
                                                        modal: true,
                                                        icon: Ext.Msg.INFO
                                                    });
                                                    var params =[];
                                                    if (size >= 1){
                                                        params = {
                                                            login:values.get('login'),
                                                            password:values.get('password'),
                                                            what:"clear_pr_kv"

                                                        };
                                                        Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
                                                            Ext.Object.merge(val.data, params);
                                                            QueryAddress.updateRecords(val.data,function(results){
                                                                if(results.res){
                                                                    return  true;
                                                                }  else {
                                                                    return  false;
                                                                }
                                                            });

                                                        });
                                                        if(id_house == "188"){
                                                            StTarif.load({
                                                                params: {
                                                                    what:'TarifFromHouses',
                                                                    login:login,
                                                                    password:password
                                                                    //data:data,
                                                                    //house_id: record.get('house_id')
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        viborTarif.clearValue();
                                                                        viborTarif.setDisabled(true);
                                                                        tarif.setValue(0);
                                                                        tarif.setDisabled(true);
                                                                        btnInsTarif.setDisabled(true);

                                                                    }
                                                                },
                                                                scope:this
                                                            });
                                                        } else {

                                                            StTarif.load({
                                                                params: {
                                                                    what:'TarifFromHouse',
                                                                    login:login,
                                                                    password:password,
                                                                    //data:data,
                                                                    house_id: id_house
                                                                },
                                                                callback: function(records,operation,success){
                                                                    if(success){
                                                                        viborTarif.clearValue();
                                                                        viborTarif.setDisabled(true);
                                                                        tarif.setValue(0);
                                                                    }
                                                                },
                                                                scope:this
                                                            });
                                                        }
                                                        myMask.close();
                                                    } else {
                                                        myMask.close();
                                                        Ext.MessageBox.show({
                                                            title: 'Ошибка ',
                                                            msg: 'Не выбраны дома  для начисления',
                                                            buttons: Ext.MessageBox.OK,
                                                            icon: Ext.MessageBox.ERROR
                                                        });
                                                    }



                                                },
                                                x: 595,
                                                y: 10,
                                                disabled: true,
                                                id: 'btnClearNachKv',
                                                width: 205,
                                                icon: 'resources/css/images/ico/no.png',
                                                text: 'Сброс признака начисления',
                                                tooltip: 'Сброс признака начисления'
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
        if (instanceConfig) {
            me.getConfigurator().merge(me, config, instanceConfig);
        }
        return me.callParent([config]);
    },

    onComboboxSelect211: function(combo, record, eOpts) {
        //in use

        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTarif = Ext.data.StoreManager.get("StTarif");
        var tarif = Ext.getCmp('tarKv');
        var viborTarif = Ext.getCmp('cbTarifKv');
        var form = combo.findParentByType('form');
        var btnInsTarif = Ext.getCmp('btnInsTarifKv');

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        if (record) {
            if(record.get('house_id') == "188"){
                StTarif.load({
                    params: {
                        what:'TarifFromHouses',
                        login:login,
                        password:password
                        //data:data,
                        //house_id: record.get('house_id')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            viborTarif.clearValue();
                            viborTarif.setDisabled(true);
                            tarif.setValue(0);
                            tarif.setDisabled(true);
                            btnInsTarif.setDisabled(true);
                        }
                    },
                    scope:this
                });
            } else {

                StTarif.load({
                    params: {
                        what:'TarifFromHouse',
                        login:login,
                        password:password,
                        //data:data,
                        house_id: record.get('house_id')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            viborTarif.clearValue();
                            viborTarif.setDisabled(true);
                            tarif.setValue(0);

                        }
                    },
                    scope:this
                });
            }
        }
    },

    onCbTarifKvSelect: function(combo, record, eOpts) {
        //in use

        //STORE

        var form = combo.findParentByType('form');
        var tarif = form.getForm().findField('tar');
        var grid = Ext.getCmp('grTarifHousesKv');
        var btnInsTarif = Ext.getCmp('btnInsTarifKv');
        var selected = record;

        if (record) {
            var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection()[0];

            var size = Ext.Object.getSize(gridRowSelectedRecords) ;
            btnInsTarif.setDisabled(false);
            tarif.setDisabled(false);


            tarif.setValue(gridRowSelectedRecords.get(record.get('tarif')));

        }

    }

});