/*
 * File: app/view/sprav/TabTarif.js
 * Date: Wed Apr 05 2017 19:04:26 GMT+0300 (EEST)
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Osmd.view.sprav.TabTarif', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.tabtarif',

    requires: [
        'Osmd.view.sprav.TabTarifViewModel',
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.view.Table',
        'Ext.toolbar.Toolbar',
        'Ext.form.field.ComboBox',
        'Ext.selection.CheckboxModel',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.panel.Tool'
    ],

    viewModel: {
        type: 'tabtarif'
    },
    height: 766,
    id: 'tabKvartplata1',
    maxWidth: 950,
    scrollable: true,
    width: 950,
    layout: 'fit',
    bodyBorder: false,
    closable: true,
    title: 'Тарифы по дому',
    defaultListenerScope: true,

    initConfig: function(instanceConfig) {
        var me = this,
            config = {
                items: [
                    {
                        xtype: 'form',
                        id: 'fmTarif',
                        scrollable: true,
                        headerPosition: 'left',
                        title: '',
                        items: [
                            {
                                xtype: 'gridpanel',
                                anchor: '100%',
                                id: 'grTarif',
                                padding: 10,
                                scrollable: true,
                                width: 900,
                                bodyBorder: true,
                                title: 'Дома',
                                store: 'StTarif',
                                viewConfig: {
                                    getRowClass: function(record, rowIndex, rowParams, store) {
                                        if(record.get('pr') === "0" ){
                                            return 'change_color_yellow';

                                        } else  {
                                            return  'change_color_green';
                                        }
                                    }
                                },
                                dockedItems: [
                                    {
                                        xtype: 'toolbar',
                                        dock: 'top',
                                        items: [
                                            {
                                                xtype: 'combobox',
                                                width: 220,
                                                fieldLabel: 'Дом',
                                                labelWidth: 45,
                                                name: 'id_house',
                                                displayField: 'house',
                                                queryMode: 'local',
                                                store: 'StHousesOrg',
                                                valueField: 'house_id',
                                                listeners: {
                                                    select: 'onComboboxSelect211'
                                                }
                                            }
                                        ]
                                    }
                                ],
                                selModel: Ext.create('Ext.selection.CheckboxModel', {
                                    selType: 'checkboxmodel',
                                    showHeaderCheckbox: true
                                }),
                                columns: [
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Дом',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                width: 43,
                                                dataIndex: 'house_id',
                                                menuDisabled: true,
                                                text: 'ид',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'datecolumn',
                                                width: 100,
                                                align: 'center',
                                                dataIndex: 'data',
                                                menuDisabled: true,
                                                text: 'дата',
                                                format: 'F,y'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 120,
                                                dataIndex: 'house',
                                                menuDisabled: true,
                                                text: 'Дом'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 35,
                                                dataIndex: 'floor',
                                                menuDisabled: true,
                                                text: 'Эт',
                                                format: '0'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Квартплата дома до 12эт',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                text: '1 этаж',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv9f1',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv9f1',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                text: '2й и выше',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv9',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv9',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Квартплата дома свыше 12эт',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                text: '1 этаж',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv16f1',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv16f1',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                text: '2й и выше',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'kv16',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    },
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 55,
                                                        align: 'center',
                                                        dataIndex: 'ch_kv16',
                                                        menuDisabled: true,
                                                        text: 'Пер',
                                                        format: '0.000'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: 'Тариф для льготников',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                text: '1 этаж',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'lgf1',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                text: '2й и выше',
                                                columns: [
                                                    {
                                                        xtype: 'numbercolumn',
                                                        width: 60,
                                                        align: 'center',
                                                        dataIndex: 'lg',
                                                        menuDisabled: true,
                                                        text: 'Тар',
                                                        format: '0.000'
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        hidden: true,
                                        dataIndex: 'raion',
                                        text: 'Raion'
                                    }
                                ],
                                tools: [
                                    {
                                        xtype: 'tool',
                                        callback: function(owner, tool, event) {
                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var StTarif = Ext.data.StoreManager.get("StTarif");
                                            //LOGIN & PASSWORD
                                            var values =stUser.getAt(0);
                                            var login = values.get('login');
                                            var password = values.get('password');
                                            // FORM
                                            var tarif = Ext.getCmp('tarKv');
                                            var viborTarif = Ext.getCmp('cbTarifKv');
                                            var form = tool.findParentByType('form');
                                            var value = form.getValues();

                                            StTarif.load({
                                                params: {
                                                    what:'TarifFromHouseAll',
                                                    login:login,
                                                    password:password,
                                                    house_id: value.id_house
                                                },

                                                scope:this
                                            });

                                        },
                                        type: 'search'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
        if (instanceConfig) {
            me.getConfigurator().merge(me, config, instanceConfig);
        }
        return me.callParent([config]);
    },

    onComboboxSelect211: function(combo, record, eOpts) {
        //in use

        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTarif = Ext.data.StoreManager.get("StTarif");
        var tarif = Ext.getCmp('tarKv');
        var viborTarif = Ext.getCmp('cbTarifKv');
        var form = combo.findParentByType('form');
        var btnInsTarif = Ext.getCmp('btnInsTarifKv');

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        if (record) {

                StTarif.load({
                    params: {
                        what:'TarifFromHouseOsmd',
                        login:login,
                        password:password,
                        //data:data,
                        house_id: record.get('house_id')
                    },
                    scope:this
                });
            }
    }

});